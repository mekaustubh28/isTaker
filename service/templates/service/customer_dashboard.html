{% extends 'service/base.html' %}

{% block title %} isTaker - Homepage {% endblock %}

{% block stylesheet %}
{% load static %}

<link rel="stylesheet" type="text/css" href="{% static 'service/scss/customer_dashboard/customer_dashboard.css' %}">
{% endblock %}
<style>
    button.display {
        display: none;
    }
</style>
{% block body %}
<div class="customer_container">
    <div id="carouselExampleControls" class="first-container carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="{% static 'service/images/picture1.jpg' %}" class="carousel-img d-block w-100" height="450px"
                    alt="picture1">
            </div>
            <div class="carousel-item">
                <img src="{% static 'service/images/picture2.jpg' %}" class="carousel-img d-block w-100" height="450px"
                    alt="picture2">
            </div>
            <div class="carousel-item">
                <img src="{% static 'service/images/picture3.jpg' %}" class="carousel-img d-block w-100" height="450px"
                    alt="picture3">
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls"
            data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls"
            data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
    <div class="service">
        <div class="second-container">
            <h5>Available Services</h5>
            <div class="available-services">
                <div class="accordion accordion-flush" id="accordionFlushExample">
                    {% for i in package_dict %}
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="flush-heading{{forloop.counter}}">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#flush-collapse{{forloop.counter}}" aria-expanded="false"
                                aria-controls="flush-collapse{{forloop.counter}}" id=plan{{forloop.counter}}
                                value="package {{forloop.counter}}">
                                package {{forloop.counter}}
                            </button>
                        </h2>
                        <div id="flush-collapse{{forloop.counter}}" class="accordion-collapse collapse"
                            aria-labelledby="flush-heading{{forloop.counter}}" data-bs-parent="#accordionFlushExample">
                            <div class="accordion-body">
                                <ul id="ul{{forloop.counter}}">
                                    {% for j in i %}
                                    <div style="padding: 10px; cursor:pointer" class="selected">
                                        <input type="checkbox" style="cursor:pointer" id="{{j.2}}" class="service_name" name="{{j.3}}" value="">
                                        <label style="width: 80%; cursor:pointer" for="{{j.2}}">{{j.2}}<span style="float: right;">₹{{j.3}}/-</span></label>
                                    </div>
                                    <hr style="padding: 0;margin:0;cursor:pointer">
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="third-container">
            <h5>Services Details</h5>
            <div style="height: 75%; overflow:hidden;overflow-y:scroll">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Include</th>
                            <th scope="col">price</th>
                        </tr>
                    </thead>
                    <tbody id="table-content">

                    </tbody>
                </table>
            </div>
            <form action="/customer_dashboard/{{Active_User.customer_id}}/search" method="POST" class="package_done">
                {% csrf_token %}
                <input type="hidden" name="service" id="service_list">
                <input type="hidden" name="total_price" id="total_price" placeholder="Total Price">
                <button class="btn btn-primary" id="service_reset" style="border-radius:5px;" type="button" disabled>
                    Reset
                </button>
                <button class="btn btn-primary mx-2" id="service_confirm" style="border-radius:5px;" type="submit"
                    disabled>
                    Confirm
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block javascript %}
<script>
    var x = 0

    $('input[type="checkbox"]').click(function () {
        $('button#service_confirm').attr('disabled', false)
        $('button#service_reset').attr('disabled', false)
        var service = $(this).attr('id')
        var price = $(this).attr('name')
        if ($(this).prop("checked") == true) {
            addTable(price, service)
        } else if ($(this).prop("checked") == false) {
            deleteTable(price, service)
        }
    });

    function addTable(price, service) {
        x = x + parseInt(price)
        var table = '<tr value="' + service + '"><td>' + service + '</td><th scope="row">₹' + price + '/-</th></tr>'
        document.getElementById('table-content').innerHTML += table
    }

    function deleteTable(price, service) {
        x = x - parseInt(price)
        var table = $('tr[value="' + service + '"]')
        table[0].remove()
    }

    $('button#service_confirm').click(function () {
        var service_list = []
        var service_price = []
        $('input[type="checkbox"]').attr('disabled', true)
        $('button#service_reset').attr('disabled', false)
        var table_content = $('#table-content').find('tr')
        var table = document.getElementsByTagName('table')[0];
        //console.log(table)
        for (let index = 0; index < table_content.length; index++) {
            var Row = table.rows[index + 1];
            var Content = Row.firstChild.textContent;
            var price = Row.children[1].innerHTML;
            price = price.substring(1, price.length - 2)
            service_price.push(price)
            service_list.push(Content)
        }
        service_price.push(x)
        $('input#service_list').attr('value', service_list)
        $('input#total_price').attr('value', service_price)
    })

    $('button#service_reset').click(function(){
        $('input[type="checkbox"]').prop("checked", false)
        document.getElementById('table-content').innerHTML = ''
        $('button#service_confirm').attr('disabled', true)
        $('button#service_reset').attr('disabled', true)
    })
</script>
<script src="{% static 'service/js/customer_dashboard.js' %}"></script>
{% endblock %}